{"version":3,"sources":["../../src/lightstep-datasource/query_ctrl.js"],"names":["QueryCtrl","defaultPercentiles","LightStepDatasourceQueryCtrl","$scope","$injector","target","percentiles","showExemplars","showOpsCounts","showErrorCounts","showErrorCountsAsRate","scope","type","savedSearches","datasource","metricFindQuery","query","then","results","slice","rawQuery","panelCtrl","refresh","savedSearchID","dashboardURL","projectName","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAQA,e,kBAAAA,S;;;;;;;;;;;;;;;;;;;;;AAGFC,wB,GAAqB,CAAC,IAAD,EAAO,IAAP,EAAa,MAAb,EAAqB,OAArB,C;;8CAEdC,4B;;;AACX,8CAAYC,MAAZ,EAAoBC,SAApB,EAAgC;AAAA;;AAAA,kKACxBD,MADwB,EAChBC,SADgB;;AAG9B,cAAI,MAAKC,MAAL,CAAYC,WAAZ,IAA2B,IAA/B,EAAqC;AACnC,kBAAKD,MAAL,CAAYC,WAAZ,GAA0BL,kBAA1B;AACD;;AAED,cAAI,MAAKI,MAAL,CAAYE,aAAZ,IAA6B,IAAjC,EAAuC;AACrC,kBAAKF,MAAL,CAAYE,aAAZ,GAA4B,IAA5B;AACD;;AAED,cAAI,MAAKF,MAAL,CAAYG,aAAZ,IAA6B,IAAjC,EAAuC;AACrC,kBAAKH,MAAL,CAAYG,aAAZ,GAA4B,IAA5B;AACD;;AAED,cAAI,MAAKH,MAAL,CAAYI,eAAZ,IAA+B,IAAnC,EAAyC;AACvC,kBAAKJ,MAAL,CAAYI,eAAZ,GAA8B,IAA9B;AACD;;AAED,cAAI,MAAKJ,MAAL,CAAYK,qBAAZ,IAAqC,IAAzC,EAA+C;AAC7C,kBAAKL,MAAL,CAAYK,qBAAZ,GAAoC,KAApC;AACD;;AAED,gBAAKC,KAAL,GAAaR,MAAb;AACA,gBAAKE,MAAL,CAAYO,IAAZ,GAAmB,WAAnB;AACA,gBAAKC,aAAL,GAAqB,MAAKC,UAAL,CAAgBC,eAAhB,EAArB;AAzB8B;AA0B/B;;;;qCAEUC,K,EAAO;AAChB;AACA,mBAAO,KAAKH,aAAL,CAAmBI,IAAnB,CAAwB;AAAA,qBAAWC,QAAQC,KAAR,EAAX;AAAA,aAAxB,CAAP;AACD;;;6CAEkB;AACjB,iBAAKd,MAAL,CAAYe,QAAZ,GAAuB,CAAC,KAAKf,MAAL,CAAYe,QAApC;AACD;;;6CAEkB;AACjB,iBAAKC,SAAL,CAAeC,OAAf,GADiB,CACS;AAC3B;;;4CAEiB;AAChB,gBAAMC,gBAAgB,KAAKlB,MAAL,CAAYA,MAAlC;AACA,mBAAU,KAAKS,UAAL,CAAgBU,YAA1B,SAA0C,KAAKV,UAAL,CAAgBW,WAA1D,mBAAmFF,aAAnF;AACD;;;;QA7C+CvB,S;;;;AAgDlDE,mCAA6BwB,WAA7B,GAA2C,iDAA3C","file":"query_ctrl.js","sourcesContent":["import {QueryCtrl} from 'app/plugins/sdk';\nimport './css/query-editor.css!'\n\nconst defaultPercentiles = [\"50\", \"99\", \"99.9\", \"99.99\"];\n\nexport class LightStepDatasourceQueryCtrl extends QueryCtrl {\n  constructor($scope, $injector)  {\n    super($scope, $injector);\n\n    if (this.target.percentiles == null) {\n      this.target.percentiles = defaultPercentiles;\n    }\n\n    if (this.target.showExemplars == null) {\n      this.target.showExemplars = true;\n    }\n\n    if (this.target.showOpsCounts == null) {\n      this.target.showOpsCounts = true;\n    }\n\n    if (this.target.showErrorCounts == null) {\n      this.target.showErrorCounts = true;\n    }\n\n    if (this.target.showErrorCountsAsRate == null) {\n      this.target.showErrorCountsAsRate = false;\n    }\n\n    this.scope = $scope;\n    this.target.type = 'timeserie';\n    this.savedSearches = this.datasource.metricFindQuery();\n  }\n\n  getOptions(query) {\n    // Defensive copy of the results because somewhere is gets mutated after return.\n    return this.savedSearches.then(results => results.slice());\n  }\n\n  toggleEditorMode() {\n    this.target.rawQuery = !this.target.rawQuery;\n  }\n\n  onChangeInternal() {\n    this.panelCtrl.refresh(); // Asks the panel to refresh data.\n  }\n\n  linkToLightStep() {\n    const savedSearchID = this.target.target;\n    return `${this.datasource.dashboardURL}/${this.datasource.projectName}/operation/${savedSearchID}`;\n  }\n}\n\nLightStepDatasourceQueryCtrl.templateUrl = 'lightstep-datasource/partials/query.editor.html';\n\n"]}